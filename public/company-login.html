<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Company Login - Stockify</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    body{font-family:Segoe UI, Tahoma, Geneva, Verdana, sans-serif;background:#f5f5f5}
    .box{max-width:420px;margin:80px auto;background:#fff;padding:24px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.06)}
    label{display:block;margin-bottom:6px;font-weight:600}
    input{width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;margin-bottom:12px}
    .btn{background:#667eea;color:#fff;border:none;padding:10px 16px;border-radius:6px;cursor:pointer}
    .muted{color:#666;font-size:0.9rem}
    .alert{padding:12px;border-radius:6px;margin-bottom:12px}
    .success{background:#e6ffed;border:1px solid #c7f0d1;color:#134b2c}
    .error{background:#ffe6e9;border:1px solid #f1c0c7;color:#6b0f1a}
  </style>
</head>
<body>
  <div class="box">
    <h2>Company Login</h2>
    <div id="message"></div>
    <form id="companyLogin">
      <label>Username or Email</label>
      <input id="username" required />
      <label>Password</label>
      <input id="password" type="password" required />
      <div style="display:flex;gap:8px;align-items:center">
        <button class="btn" type="submit">Login</button>
        <a href="company-signup.html" style="margin-left:8px">Create company account</a>
      </div>
    </form>
  </div>
<script>
  const API = 'http://localhost:4000';
  const msg = document.getElementById('message');
  document.getElementById('companyLogin').addEventListener('submit', async (e)=>{
    e.preventDefault(); msg.innerHTML='';
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value;
    try{
      const res = await fetch(`${API}/auth/login`, { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({ username, password }) });
      const j = await res.json();
      if(!res.ok) return msg.innerHTML = `<div class="alert error">${j.error||j.message||'Login failed'}</div>`;
      localStorage.setItem('authToken', j.token);
      if(j.user_id) localStorage.setItem('userId', String(j.user_id));
      if(j.name) localStorage.setItem('userName', j.name);
      if(j.role) localStorage.setItem('role', j.role);
      if(j.company_id) localStorage.setItem('companyId', String(j.company_id));
      // redirect to company dashboard if company_id exists else check role
      if(j.company_id || j.role === 'company') window.location.href='company-dashboard.html'; else window.location.href='dashboard.html';
    }catch(err){ console.error(err); msg.innerHTML=`<div class="alert error">${err.message}</div>`; }
  });
</script>
</body>
</html>
